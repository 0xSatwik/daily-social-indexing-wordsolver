name: Daily Social Indexing & Pinterest Pins

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform'
        required: true
        default: 'indexing'
        type: choice
        options:
          - indexing
          - social
      puzzle_type:
        description: 'Puzzle type (for social action)'
        required: false
        default: 'none'
        type: choice
        options:
          - none
          - wordle
          - quordle
          - colordle
          - semantle
          - phoodle

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Determine action based on input
        id: determine
        run: |
          echo "action=${{ github.event.inputs.action }}" >> $GITHUB_OUTPUT
          echo "puzzle=${{ github.event.inputs.puzzle_type }}" >> $GITHUB_OUTPUT
      
      - name: Run Indexing (12:00 AM IST)
        if: contains(steps.determine.outputs.action, 'indexing')
        env:
          GOOGLE_SERVICE_ACCOUNT_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
          ACTION: indexing
        run: python main.py
      
      - name: Run Social Post
        if: steps.determine.outputs.puzzle != 'none' && steps.determine.outputs.puzzle != ''
        env:
          PINTEREST_ACCESS_TOKEN: ${{ secrets.PINTEREST_ACCESS_TOKEN }}
          PINTEREST_USE_SANDBOX: ${{ secrets.PINTEREST_USE_SANDBOX || 'true' }}
          FACEBOOK_ACCESS_TOKEN: ${{ secrets.FACEBOOK_ACCESS_TOKEN }}
          FACEBOOK_PAGE_ID: ${{ secrets.FACEBOOK_PAGE_ID }}
          ACTION: social
          PUZZLE_TYPE: ${{ steps.determine.outputs.puzzle }}
        run: python main.py
